<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reading OPUS binary files from Bruker® spectrometers in R • opusreader2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading OPUS binary files from Bruker® spectrometers in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">opusreader2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/opusreader2_introduction.html">Reading OPUS binary files from Bruker® spectrometers in R</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spectral-cockpit/opusreader2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reading OPUS binary files from Bruker® spectrometers in R</h1>
                        <h4 data-toc-skip class="author">Philipp Baumann
and Thomas Knecht</h4>
            
            <h4 data-toc-skip class="date">2025-04-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/spectral-cockpit/opusreader2/blob/main/vignettes/opusreader2_introduction.Rmd" class="external-link"><code>vignettes/opusreader2_introduction.Rmd</code></a></small>
      <div class="d-none name"><code>opusreader2_introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>Spectrometers from <a href="https://www.bruker.com/en.html" class="external-link">Bruker®
Optics GmbH &amp; Co. KG</a> save spectra in a binary file format known
as OPUS. Each OPUS file corresponds to one sample measurement, typically
acquired through the OPUS spectroscopy software. These files feature
numerical extensions, with extension numbers incrementing based on the
naming scheme chosen in the OPUS software.</p>
<p>The OPUS suite and the file specification are proprietary, leading to
the need for an implementation based on reverse engineering in this
package. With {opusreader2}, you can access your spectroscopic data in
the open computing language R, providing full control over your spectral
data workflow. Our package specifically reads binary files for most
Fourier-Transform Infrared (FT-IR) spectrometers from Bruker® Optics
GmbH. While it may work for other products like Raman spectrometers,
further adjustments are required to support new block types (data and
parameters; see below).</p>
</div>
<div class="section level2">
<h2 id="opus-data-extraction">OPUS data extraction<a class="anchor" aria-label="anchor" href="#opus-data-extraction"></a>
</h2>
<p>The processing of each OPUS file begins by extracting essential
information from a designated byte range in the file header. This
section contains crucial details about binary blocks (also called
chunks), including byte offsets, sizes, and data types within the file.
The parsing algorithm utilizes this information to extract modular
blocks of data and parameters from byte sequences. As illustrated in the
figure below, the content of the files varies based on the instrument
type, user-selected data (spectrum) blocks to save, and specific
settings.</p>
<div class="float" id="fig:opus_settings">
<img src="images/opus-measurement-settings.png" alt="OPUS measurement settings for Bruker INVENIO® fourier-transform (FT) mid-infrared spectrometer"><div class="figcaption">OPUS measurement settings for Bruker INVENIO®
fourier-transform (FT) mid-infrared spectrometer</div>
</div>
<p>In addition to result spectra, the binary files encompass:</p>
<ul>
<li><p>a comprehensive set of measurement parameters (configurations,
conditions)</p></li>
<li><p>single-channel data from background measurements done before the
sample</p></li>
<li><p>other types of intermediate spectra. Currently, we support
<em>“data blocks to be saved</em> <em>“</em> for fourier-transform
infrared spectrometers.</p></li>
</ul>
<div class="section level3">
<h3 id="reading-and-parsing-opus-files-in-r">Reading and parsing OPUS files in R<a class="anchor" aria-label="anchor" href="#reading-and-parsing-opus-files-in-r"></a>
</h3>
<p>With the main function <code><a href="../reference/read_opus.html">read_opus()</a></code> you can either read
single or multiple OPUS files. Let’s take an example file produced by a
Bruker ALPHA® spectrometer that measures mid-infrared spectra with a
diffuse-reflectance accessory. This spectral measurement of a soil
sample comes with the package and is also part of the data set in
Baumann et al. (2020). Here is how OPUS software represents parsed
blocks in the OPUS viewer software from Bruker®.</p>
<div class="float">
<img src="images/OPUS_block1.png" alt="Data parameters for absorbance (AB) spectrum"><div class="figcaption">Data parameters for absorbance (AB)
spectrum</div>
</div>
<p>We can extract all those blocks from the corresponding OPUS file
example. We can even explore additional blocks that are not visually
displayed in the official software but are present in the file (more
details below).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://spectral-cockpit.github.io/opusreader2/">"opusreader2"</a></span><span class="op">)</span></span>
<span><span class="co"># example file</span></span>
<span><span class="va">file_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_data"</span>, <span class="st">"BF_lo_01_soil_cal.1"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"opusreader2"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">spectrum_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_opus.html">read_opus</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">file_1</span><span class="op">)</span></span></code></pre></div>
<p>The <code>dsn</code> argument provides is the data source name. It is
currently either a character vector of the folder path to read files
from recursively, or character vector of specific OPUS file paths.</p>
<p><strong><code><a href="../reference/read_opus.html">read_opus()</a></code></strong> returns a nested list of
class <code>"list_opusreader2"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">spectrum_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spectrum_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>At the first level of the list output, data is arranged as shown in
the Bruker OPUS viewer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meas_1</span> <span class="op">&lt;-</span> <span class="va">spectrum_1</span><span class="op">[[</span><span class="st">"BF_lo_01_soil_cal.1"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">meas_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>To gain insights into block names, associated data, and parameters,
we suggest consulting the help documentation via
<code><a href="../reference/read_opus.html">?read_opus</a></code>. We’ve formatted the block names in
<code>camel_case</code> within the second level of the
<code>"opusreader2_list"</code> output, facilitating improved
programmatic access.</p>
<p>Printing the complete <code>"opusreader2_list"</code> object in the R
console keeps the console occupied for a significant amount of time. For
more efficient examination in RStudio, we recommend using the <em>list
preview</em> feature with <code>View(spectrum_1)</code>, accessible
through the <em>Environment</em> tab. Here we employ base R subsetting,
<code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code>, and <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> to explore examples of
measured spectral data.</p>
<p>This output reveals three list elements that may not be visible in
the Bruker® viewer pane.</p>
<ol style="list-style-type: decimal">
<li>
<code>basic_metadata</code>: This data frame serves as minimal
metadata to identify measurements. It contains the file name at time of
parsing, the sample name entered prior measurement, and different time
stamps. This field is for example useful to build data pipelines for
spectral libraries and prediction services.</li>
<li>
<code>ab_no_atm_comp_data_param</code>: Parameters for the
absorbance (AB) block prior to atmospheric compensation.</li>
<li>
<code>ab_no_atm_comp</code>:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meas_1</span><span class="op">$</span><span class="va">basic_metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt;  NULL</span></span></code></pre></div>
<p>We can for example verify the frequency of the first point (FXV). All
types of data and parameters within OPUS files are encoded with three
capital letters each.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meas_1</span><span class="op">$</span><span class="va">ab_data_param</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">FXV</span><span class="op">$</span><span class="va">parameter_value</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Besides the data or parameter values, the output of each parsed OPUS
block contains the block type, channel type, text type, additional type,
the offset in bytes, next offset in bytes, and the chunk size in bytes
for particular data blocks. This is decoded from the file header and
allows for traceability in the parsing process.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">meas_1</span><span class="op">$</span><span class="va">ab_data_param</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "NULL"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meas_1</span><span class="op">$</span><span class="va">ab_data_param</span><span class="op">)</span></span>
<span><span class="co">#&gt;  NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meas_1</span><span class="op">$</span><span class="va">instrument</span><span class="op">)</span></span>
<span><span class="co">#&gt;  NULL</span></span></code></pre></div>
<p>The first example mid-infrared spectrum was measured with atmospheric
compensation (carbon dioxide and water bands), which is done on based on
the background spectra. The measurement option is called “Atmospheric
compensation” in the OPUS software. The goal of this routine is to
remove artefacts from CO2 and water bands in the measurement module.
Generally, OPUS files have trace every step or macro applied in the file
output. Reading both raw and transformed data gives us flexibility and
the possibility to do extended quality control prior to further data
processing, modeling, and estimating new samples.</p>
</div>
<div class="section level3">
<h3 id="reading-opus-files-recursively-from-folder">Reading OPUS files recursively from folder<a class="anchor" aria-label="anchor" href="#reading-opus-files-recursively-from-folder"></a>
</h3>
<p>A data source name (<code>dsn</code>) can be a folder, too. This
makes it convenient to read all OPUS files located below a certain
folder level. We illustrate it with all OPUS test files that come with
{opusreader2}, which are are also used in unit tests.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_data"</span>, package <span class="op">=</span> <span class="st">"opusreader2"</span><span class="op">)</span></span>
<span><span class="va">data_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_opus.html">read_opus</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">test_dsn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>We can get the instrument name of the test files like this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_instrument_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">instrument</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">INS</span><span class="op">$</span><span class="va">parameter_value</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_test</span>, <span class="va">get_instrument_name</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "INVENIO-R"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "VERTEX 70"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "Alpha"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] "Tango"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] "TENSOR II"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reading-opus-files-in-parallel">Reading OPUS files in parallel<a class="anchor" aria-label="anchor" href="#reading-opus-files-in-parallel"></a>
</h3>
</div>
<div class="section level3">
<h3 id="reading-a-single-opus-file">Reading a single OPUS file<a class="anchor" aria-label="anchor" href="#reading-a-single-opus-file"></a>
</h3>
<p>For single OPUS files, there <code><a href="../reference/read_opus_single.html">read_opus_single()</a></code>
implementation can also be used</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_opus_single.html">read_opus_single</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">file_1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philipp Baumann, Thomas Knecht, Pierre Roudier, spectral-cockpit.com.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
