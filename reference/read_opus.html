<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read OPUS binary files produced by a Bruker spectrometer — read_opus • opusreader2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Read OPUS binary files produced by a Bruker spectrometer — read_opus"><meta name="description" content="This function can be used to read and parse OPUS files,
to make it usable for other processing steps."><meta property="og:description" content="This function can be used to read and parse OPUS files,
to make it usable for other processing steps."><meta property="og:image" content="https://spectral-cockpit.github.io/opusreader2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">opusreader2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/opusreader2_introduction.html">Reading OPUS binary files from Bruker® spectrometers in R</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/spectral-cockpit/opusreader2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Read OPUS binary files produced by a Bruker spectrometer</h1>
      <small class="dont-index">Source: <a href="https://github.com/spectral-cockpit/opusreader2/blob/main/R/read_opus.R" class="external-link"><code>R/read_opus.R</code></a></small>
      <div class="d-none name"><code>read_opus.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function can be used to read and parse OPUS files,
to make it usable for other processing steps.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">read_opus</span><span class="op">(</span></span>
<span>  <span class="va">dsn</span>,</span>
<span>  data_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .parallel_backend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mirai"</span>, <span class="st">"future"</span><span class="op">)</span>,</span>
<span>  progress_bar <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dsn">dsn<a class="anchor" aria-label="anchor" href="#arg-dsn"></a></dt>
<dd><p>data source name. Can be a path to a specific file or a path to a
directory. The listing of the files in a directory is recursive.</p></dd>


<dt id="arg-data-only">data_only<a class="anchor" aria-label="anchor" href="#arg-data-only"></a></dt>
<dd><p>read data and parameters with <code>FALSE</code> per default, or only
read data
<code>NULL</code>, which only returns the parsed data as an in-memory R object.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>read files in parallel via chunking. Default is <code>FALSE</code>.</p></dd>


<dt id="arg--parallel-backend">.parallel_backend<a class="anchor" aria-label="anchor" href="#arg--parallel-backend"></a></dt>
<dd><p>string with backend that handles reading spectra
in parallel. Currently, <code>"mirai"</code> (default, non-blocking parallel map) and
<code>"future"</code> are supported. See section "Details" for more information.</p></dd>


<dt id="arg-progress-bar">progress_bar<a class="anchor" aria-label="anchor" href="#arg-progress-bar"></a></dt>
<dd><p>print a progress bar. Default is <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Nested list (S3 object) containing the parsed contents of the binary
encoded blocks of an OPUS file. The first level names of the list correspond
to the display names as shown in the Bruker OPUS viewer software. However, in
snake_case and more standardized naming to allow for better output handling.
Each parsed block element is a sublist containing <strong>a)</strong> the binary read
instructions decoded/derived from the header (<code>$block_type</code>, <code>$channel_type</code>,
<code>$text_type</code> and <code>$additional_type</code>, <code>$offset</code> (bytes), <code>$next_offset</code>
(bytes), <code>$chunk_size</code> (bytes)); <strong>b)</strong> if parameter block, nested list of
specific parameters under <code>$parameters</code>, which has elements named according
to capitalized Bruker-internal "three-letter-string" definitions (e.g.,
"DPF := Data Point Format"). Possible first-level block names and
information provided include:</p><ul><li><p><strong><code>refl_no_atm_comp_data_param</code></strong> : class "parameter"
(viewer: "Data Parameters Refl". Parameter list with metadata for <code>refl</code>
data block (<code>refl</code>).</p></li>
<li><p><strong><code>refl_no_atm_comp</code></strong>: class "data" (spectrum; viewer: "Refl").
Unprocessed (raw; i.e, not atmospherically compensated) reflectance spectra
(<code>:= sc_sample / sc_ref</code>). Note that this element is the
untreated spectra before an eventual "atmospheric compensation"
routine is applied.</p></li>
<li><p><strong><code>refl_data_param</code></strong> : class "parameter" (viewer: "Data Parameters Refl").
Parameter list with metadata for <code>refl</code> data block (metadata of
reflectance spectrum; see <code>refl</code> output).
Note that this element only results if "atmospheric compensation" was
activated in the OPUS measurement settings.</p></li>
<li><p><strong><code>refl</code></strong>: class "data" (spectrum; viewer: "Refl"). Atmospherically
compensated reflectance spectra (<code>:= sc_sample_corr / sc_ref_corr</code>). This
result spectrum only exists if either correction of CO2 and/or water vapour
bands is set in OPUS setting (proprietary algorithm; could possibly be
reverse engineered). If <code>refl</code> exists, it has always a corresponding
untreated <code>refl_no_atm_comp</code> spectrum  (the latter present in file but not
shown in the OPUS viewer, where only (final) <code>ab</code> is displayed)</p></li>
<li><p><strong><code>quant_report_refl</code></strong>: class "parameter" (viewer: "Quant Report Refl").
Quantification report for tools of multivariate calibration on <code>refl</code> data
(i.e., PLS regression) offered in the QUANT2 OPUS package. Nested list with
Bruker-internal "three-letter-string" definitions. "TIT" is the title of
a nested quantification table, <code>"E&lt;digit&gt;[2]"</code> stands probably for entry,
<code>"F&lt;digit&gt;[2]"</code> for field, and <code>"Z&lt;digit&gt;[2]"</code> we do not yet know what it
maps to. There seems more information needed, which we can get by expanding
the header parsing algorithm.</p></li>
<li><p><strong><code>ab_no_atm_comp_data_param</code></strong> : class "parameter"
(viewer: "Data Parameters AB"). Parameter list with metadata for <code>ab</code>
data block (spectrum; see <code>ab</code> output).</p></li>
<li><p><strong><code>ab_no_atm_comp</code></strong>: class "data" (spectrum; viewer: "Refl").
Unprocessed (raw; i.e, not atmospherically compensated) reflectance spectra
(<code>:= sc_sample/ sc_ref</code>).</p></li>
<li><p><strong><code>ab_data_param</code></strong> : class "parameter" (viewer: "Data Parameters Refl").
Parameter list with metadata for <code>ab</code> data block (spectrum; see <code>ab</code>).
Note that this element only results if "atmospheric compensation" was
activated in the OPUS measurement settings.</p></li>
<li><p><strong><code>ab</code></strong>: class "data" (spectrum; viewer: "AB"). Atmospherically
compensated (apparent) absorbance spectra
(<code>:= log10(1 / (sc_sample_corr / sc_ref_corr)</code>). Only
exists if either correction of CO2 and/or water vapour bands is set in OPUS
setting (proprietary algorithm; could possibly be reverse engineered).
If <code>AB</code> exists, it has always a corresponding untreated
<code>ab_no_atm_comp</code> spectrum (the latter present in file but not shown in
the OPUS viewer, where only final <code>ab</code> is displayed).</p></li>
<li><p><strong><code>quant_report_ab</code></strong>: class "parameter" (viewer: "Quant Report AB").
Quantification report for tools of multivariate calibration on <code>ab</code> data
(i.e., PLS regression) offered in the QUANT2 OPUS package. Nested list with
Bruker-internal "three-letter-string" definitions. "TIT" is the title of
a nested quantification table, <code>"E&lt;digit&gt;[2]"</code> stands probably for entry,
<code>"F&lt;digit&gt;[2]"</code> for field, and <code>"Z&lt;digit&gt;[2]"</code> we do not yet know what it
maps to. There seems more information needed, which we can get by expanding
the header parsing algorithm.</p></li>
<li><p><strong><code>sc_sample_data_param</code></strong>: class "parameter" (metadata; viewer:
"Data Parameters ScSm").
Describes the <code>sc_sample</code> data block (see <code>sc_sample</code>).</p></li>
<li><p><strong><code>sc_sample</code></strong>: class "data" (spectrum). Single channel (sc) spectrum of
the sample (y-axis: intensity).</p></li>
<li><p><strong><code>ig_sample_data_param</code></strong>: class "parameter" (metadata; viewer:
"Data Parameters IgSm").</p></li>
<li><p><strong><code>ig_sample</code></strong>: class "data" (signal, viewer: "IgSm").
Interferogram of the sample measurement. Oscillatory signal
(x-axis: optical path difference (OPD); y-axis: amplitude of the signal).</p></li>
<li><p><strong><code>sc_ref_data_param</code></strong>: class "parameter" (metadata; viewer:
"Data Parameters ScRf").
Describes the <code>sc_sample</code> data block (see <code>sc_ref</code>).</p></li>
<li><p><strong><code>sc_ref</code></strong>: class "data" (spectrum; viewer: "Data Parameters IgSm").
Single channel (sc) spectrum of the reference (background material: e.g.,
gold; y-axis: intensity).</p></li>
<li><p><strong><code>ig_ref_data_param</code></strong>: class "parameter" (metadata; viewer:
"Data Parameters IgRf").</p></li>
<li><p><strong><code>ig_ref</code></strong>: class "data" (spectrum; viewer: "IgRf").
Interferogram of the reference measurement. (background material: e.g.,
gold). Oscillatory signal (x-axis: optical path difference (OPD);
y-axis: amplitude of the signal)</p></li>
<li><p><strong><code>optics</code></strong>: class "parameter (metadata; viewer: "Optic Parameters").
Optic setup and settings such as "Accessory", "Detector Setting" or
"Source Setting".</p></li>
<li><p><strong><code>optics_ref</code></strong>: class "parameter (metadata; viewer: "Optic Parameters
Rf"). Optic setup and settings specific to reference measurement such as
"Accessory", "Detector Setting" or "Source Setting".</p></li>
<li><p><strong><code>acquisition_ref</code></strong>: class "parameter" (metadata; viewer: "Acquisition
parameters Rf". Settings such as ""Additional Data Treatment", (number) of
"Background Scans" or "Result Spectrum" (e.g. value "Absorbance").</p></li>
<li><p><strong><code>fourier_transformation_ref</code></strong>:</p></li>
<li><p><strong><code>fourier_transformation</code></strong>: class "parameter"</p></li>
<li><p><strong><code>sample</code></strong>:</p></li>
<li><p><strong><code>acquisition</code></strong>:</p></li>
<li><p><strong><code>instrument_ref</code></strong>:</p></li>
<li><p><strong><code>instrument</code></strong>:</p></li>
<li><p><strong><code>lab_and_process_param_1</code></strong>:</p></li>
<li><p><strong><code>lab_and_process_param_2</code></strong>:</p></li>
<li><p><strong><code>info_block</code></strong>:</p></li>
<li><p><strong><code>history</code></strong>:</p></li>
<li><p><strong><code>unknown</code></strong>: if a block-type can not be matched, no parsing is done and
an empty list entry is returned. This gives you a hint that there is
a block that can not yet be parsed. You can take further steps by
opening an issue.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p><code>read_opus()</code> is the high-level interface to read multiple OPUS files at
once from a data source name (<code>dsn</code>).</p>
<p>It optionally supports parallel reads via <code>{mirai}</code> (default) and <code>{future}</code>
backend.</p>
<p>When reading in parallel, a progress bar can be enabled.
For <code>.parallel_backend = "multisession"</code>, <code>{cli}</code> provides progress updates.
For <code>.parallel_backend = "future"</code>, <code>{progressr}</code> is required for
progress updates.</p><div class="section">
<h3 id="-mirai-backend">"mirai" backend<a class="anchor" aria-label="anchor" href="#-mirai-backend"></a></h3>


<p>mirai provides a highly efficient asynchronous parallel evaluation
framework via the Nanomsg Next Gen (NNG), high-perforamcne, lightweight
messaging library for distributed and concurrent applications.</p>
<p>The only thing</p>
</div>

<div class="section">
<h3 id="-future-backend">"future" backend<a class="anchor" aria-label="anchor" href="#-future-backend"></a></h3>


<p>If <code>parallel = TRUE</code>, one can specify
across how many chunks the OPUS files are distributed onto the registered
parallel workers. This can be done via <code>options(number_of_chunks = &lt;integer&gt;)</code>. The default value is <code>number_of_chunks = "registered workers"</code>,
which will split the OPUS files across number of chunks corresponding to the
number of registered workers.</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philipp Baumann, Thomas Knecht, Pierre Roudier, spectral-cockpit.com.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

